#ifndef SI1147_H
#define SI1147_H

#include "sys/etimer.h"

#define SI1147_STARTUP_TIME 0.025*CLOCK_SECOND
#define SI1147_DEFAULT_SLAVE_ADDR 0x60

// bit 6 disables auto incr when set
#define SI1147_AUTO_INCR_DISABLE 0x40

// measurement rates
#define SI1147_FORCED_CONVERSION 0
#define SI1147_US_PER_MEAS_RATE 31.25

// I2C Registers
#define SI1147_PART_ID 0x00
#define SI1147_REV_ID 0x01
#define SI1147_SEQ_ID 0x02
#define SI1147_INT_CFG 0x03
#define SI1147_INT_CFG_INT_OE_MASK 0x01
#define SI1147_IRQ_ENABLE 0x04
#define SI1147_IRQ_ENABLE_ALS_IE_MASK 0x01 // bit 0
#define SI1147_IRQ_ENABLE_PS1_IE_MASK 0x04 // bit 2
#define SI1147_IRQ_ENABLE_PS2_IE_MASK 0x08 // bit 3
#define SI1147_IRQ_ENABLE_PS3_IE_MASK 0x10 // bit 4
// 0x05 - 0x06 not listed
#define SI1147_HW_KEY 0x07
#define SI1147_MEAS_RATE0 0x08
#define SI1147_MEAS_RATE1 0x09
// 0x0A - 0x0E RSVD
#define SI1147_PS_LED21 0x0F
#define SI1147_PS_LED21_LED1_I_MASK 0x0F // lower half
#define SI1147_PS_LED21_LED2_I_MASK 0xF0 // upper half
#define SI1147_PS_LED3 0x10
#define SI1147_PS_LED3_LED3_I_MASK 0x0F // lower half
// 0x11 - 0x12 RSVD
#define SI1147_UCOEF0 0x13
#define SI1147_UCOEF1 0x14
#define SI1147_UCOEF2 0x15
#define SI1147_UCOEF3 0x16
#define SI1147_PARAM_WR 0x17
#define SI1147_COMMAND 0x18
// 0x19 - 0x1F not listed
#define SI1147_RESPONSE 0x20
#define SI1147_IRQ_STATUS 0x21
#define SI1147_IRQ_STATUS_ALS_INT_MASK 0x03
#define SI1147_IRQ_STATUS_PS1_INT_MASK 0x04
#define SI1147_IRQ_STATUS_PS2_INT_MASK 0x08
#define SI1147_IRQ_STATUS_PS3_INT_MASK 0x10
#define SI1147_IRQ_STATUS_CMD_INT_MASK 0x20
#define SI1147_ALS_VIS_DATA0 0x22
#define SI1147_ALS_VIS_DATA1 0x23
#define SI1147_ALS_IR_DATA0 0x24
#define SI1147_ALS_IR_DATA1 0x25
#define SI1147_PS1_DATA0 0x26
#define SI1147_PS1_DATA1 0x27
#define SI1147_PS2_DATA0 0x28
#define SI1147_PS2_DATA1 0x29
#define SI1147_PS3_DATA0 0x2A
#define SI1147_PS3_DATA1 0x2B
#define SI1147_AUX_DATA0 0x2C // aka UVINDEX0
#define SI1147_UVINDEX0 0x2C // aka AUX_DATA0
#define SI1147_AUX_DATA1 0x2D // aka UVINDEX1
#define SI1147_UVINDEX1 0x2D // aka AUX_DATA1
#define SI1147_PARAM_RD 0x2E
// 0x2F not listed
#define SI1147_CHIP_STAT 0x30
#define SI1147_CHIP_STAT_SLEEP_MASK 0x01 // bit 0
#define SI1147_CHIP_STAT_SUSPEND_MASK 0x02 // bit 1
#define SI1147_CHIP_STAT_RUNNING_MASK 0x04 // bit 2
#define SI1147_ANA_IN_KEY0 0x3B 
#define SI1147_ANA_IN_KEY1 0x3C 
#define SI1147_ANA_IN_KEY2 0x3D
#define SI1147_ANA_IN_KEY3 0x3E

// COMMAND register commands
#define SI1147_COMMAND_PARAM_QUERY 0x80 // [4:0] are the parameter bits
#define SI1147_COMMAND_PARAM_SET 0xA0 // [4:0] are the parameter bits
#define SI1147_COMMAND_NOP 0x00
#define SI1147_COMMAND_RESET 0x01
#define SI1147_COMMAND_BUSADDR 0x02
#define SI1147_COMMAND_PS_FORCE 0x05
#define SI1147_COMMAND_GET_CAL 0x12
#define SI1147_COMMAND_ALS_FORCE 0x06
#define SI1147_COMMAND_PSALS_FORCE 0x07
#define SI1147_COMMAND_PS_PAUSE 0x09
#define SI1147_COMMAND_ALS_PAUSE 0x0A
#define SI1147_COMMAND_PSALS_PAUSE 0xB
#define SI1147_COMMAND_PS_AUTO 0xD
#define SI1147_COMMAND_ALS_AUTO 0xE
#define SI1147_COMMAND_PSALS_AUTO 0x0F

// RESPONSE register error codes
#define SI1147_RESPONSE_NO_ERROR 0x00 // [3:0] counts how many completed
#define SI1147_RESPONSE_INVALID_SETTING 0x80
#define SI1147_RESPONSE_PS1_ADC_OVERFLOW 0x88
#define SI1147_RESPONSE_PS2_ADC_OVERFLOW 0x89
#define SI1147_RESPONSE_PS3_ADC_OVERFLOW 0x8A
#define SI1147_RESPONSE_ALS_VIS_ADC_OVERFLOW 0x8C
#define SI1147_RESPONSE_ALS_IR_ADC_OVERFLOW 0x8D
#define SI1147_RESPONSE_AUX_ADC_OVERFLOW 0x8E

#endif /*SI1147_H*/
